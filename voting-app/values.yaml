# Default values for voting-app
# This is a YAML-formatted file.

# Environment configuration (dev, staging, prod)
environment: dev

# Service name overrides (for compatibility with hardcoded service names in apps)
# Set to empty string to use Helm-generated names, or specify custom names
serviceNames:
  vote: ""  # Uses Helm fullname if empty
  result: ""  # Uses Helm fullname if empty
  db: "db"  # Must be "db" for app compatibility
  redis: "redis"  # Must be "redis" for app compatibility

# Global settings
global:
  imageRegistry: ""
  imagePullPolicy: IfNotPresent

# Vote service configuration
vote:
  enabled: true
  image:
    repository: dockersamples/examplevotingapp_vote
    tag: ""
    pullPolicy: ""
  
  replicas: 1
  service:
    type: NodePort
    port: 8080
    targetPort: 80
    nodePort: 31000
  
  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi
  
  env:
    OPTION_A: "Cats"
    OPTION_B: "Dogs"
  
  # Horizontal Pod Autoscaler
  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 5
    targetCPUUtilizationPercentage: 80
    targetMemoryUtilizationPercentage: 80

# Result service configuration
result:
  enabled: true
  image:
    repository: dockersamples/examplevotingapp_result
    tag: ""
    pullPolicy: ""
  
  replicas: 1
  service:
    type: NodePort
    port: 8081
    targetPort: 80
    nodePort: 31001
  
  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi
  
  # Note: PORT env var removed - Dockerfile sets PORT=80 by default
  # If you need to override, uncomment and set to desired port
  # env:
  #   PORT: "80"
  
  # Horizontal Pod Autoscaler
  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 5
    targetCPUUtilizationPercentage: 80
    targetMemoryUtilizationPercentage: 80

# Worker service configuration
worker:
  enabled: true
  image:
    repository: dockersamples/examplevotingapp_worker
    tag: ""
    pullPolicy: ""
  
  replicas: 1
  
  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi
  
  # Horizontal Pod Autoscaler
  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 3
    targetCPUUtilizationPercentage: 80
    targetMemoryUtilizationPercentage: 80

# Database (PostgreSQL) configuration
db:
  enabled: true
  image:
    repository: postgres
    tag: "15-alpine"
    pullPolicy: ""
  
  replicas: 1
  
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi
  
  env:
    POSTGRES_USER: postgres
    POSTGRES_PASSWORD: postgres
    POSTGRES_DB: postgres
  
  service:
    type: ClusterIP
    port: 5432
    targetPort: 5432
  
  persistence:
    enabled: true
    storageClass: ""
    accessMode: ReadWriteOnce
    size: 10Gi
    # Use emptyDir if persistence is disabled
    emptyDir: false

# Redis configuration
redis:
  enabled: true
  image:
    repository: redis
    tag: "alpine"
    pullPolicy: ""
  
  replicas: 1
  
  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi
  
  service:
    type: ClusterIP
    port: 6379
    targetPort: 6379
  
  persistence:
    enabled: false
    storageClass: ""
    accessMode: ReadWriteOnce
    size: 1Gi
    # Use emptyDir if persistence is disabled
    emptyDir: true

# Environment-specific overrides
# These values will override the defaults based on the 'environment' value
environments:
  dev:
    vote:
      replicas: 1
      resources:
        limits:
          cpu: 100m
          memory: 128Mi
        requests:
          cpu: 50m
          memory: 64Mi
    result:
      replicas: 1
      resources:
        limits:
          cpu: 100m
          memory: 128Mi
        requests:
          cpu: 50m
          memory: 64Mi
    worker:
      replicas: 1
      resources:
        limits:
          cpu: 100m
          memory: 128Mi
        requests:
          cpu: 50m
          memory: 64Mi
    db:
      persistence:
        enabled: false
        emptyDir: true
      resources:
        limits:
          cpu: 250m
          memory: 256Mi
        requests:
          cpu: 100m
          memory: 128Mi
    redis:
      persistence:
        enabled: false
        emptyDir: true
  
  staging:
    vote:
      replicas: 2
      autoscaling:
        enabled: true
        minReplicas: 2
        maxReplicas: 5
    result:
      replicas: 2
      autoscaling:
        enabled: true
        minReplicas: 2
        maxReplicas: 5
    worker:
      replicas: 2
      autoscaling:
        enabled: true
        minReplicas: 2
        maxReplicas: 3
    db:
      persistence:
        enabled: true
        size: 20Gi
      resources:
        limits:
          cpu: 1000m
          memory: 1Gi
        requests:
          cpu: 500m
          memory: 512Mi
    redis:
      persistence:
        enabled: true
        size: 2Gi
  
  prod:
    vote:
      replicas: 3
      autoscaling:
        enabled: true
        minReplicas: 3
        maxReplicas: 10
      resources:
        limits:
          cpu: 500m
          memory: 512Mi
        requests:
          cpu: 200m
          memory: 256Mi
    result:
      replicas: 3
      autoscaling:
        enabled: true
        minReplicas: 3
        maxReplicas: 10
      resources:
        limits:
          cpu: 500m
          memory: 512Mi
        requests:
          cpu: 200m
          memory: 256Mi
    worker:
      replicas: 3
      autoscaling:
        enabled: true
        minReplicas: 3
        maxReplicas: 5
      resources:
        limits:
          cpu: 500m
          memory: 512Mi
        requests:
          cpu: 200m
          memory: 256Mi
    db:
      persistence:
        enabled: true
        size: 50Gi
      resources:
        limits:
          cpu: 2000m
          memory: 2Gi
        requests:
          cpu: 1000m
          memory: 1Gi
    redis:
      persistence:
        enabled: true
        size: 5Gi
      resources:
        limits:
          cpu: 500m
          memory: 512Mi
        requests:
          cpu: 200m
          memory: 256Mi

